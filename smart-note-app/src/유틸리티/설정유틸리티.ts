// 설정 관련 유틸리티 함수들
import { 폴더설정타입, 노트설정타입 } from '../타입';
import { 기본채팅표시설정, 기본요약표시설정 } from './채팅표시유틸리티';

/**
 * 폴더 설정에 기본 표시 설정이 없는 경우 추가하는 함수
 */
export const 폴더설정기본값적용하기 = (폴더설정: 폴더설정타입): 폴더설정타입 => {
  return {
    ...폴더설정,
    기본채팅표시설정: 폴더설정.기본채팅표시설정 || 기본채팅표시설정,
    기본요약표시설정: 폴더설정.기본요약표시설정 || 기본요약표시설정
  };
};

/**
 * 새 폴더 생성 시 사용할 기본 폴더 설정
 */
export const 기본폴더설정생성하기 = (): 폴더설정타입 => {
  return {
    시간표시여부: true,
    입력방식: '단순채팅',
    하위입력활성화: false,
    기본채팅표시설정: 기본채팅표시설정,
    기본요약표시설정: 기본요약표시설정
  };
};

/**
 * 노트별 설정과 폴더 기본 설정을 병합하는 함수
 */
export const 노트설정병합하기 = (
  노트설정: 노트설정타입 | undefined, 
  폴더설정: 폴더설정타입
): {
  채팅표시설정: NonNullable<노트설정타입['채팅표시설정']>;
  요약표시설정: NonNullable<노트설정타입['요약표시설정']>;
} => {
  const 폴더기본설정 = 폴더설정기본값적용하기(폴더설정);
  
  return {
    채팅표시설정: 노트설정?.채팅표시설정 || 폴더기본설정.기본채팅표시설정,
    요약표시설정: 노트설정?.요약표시설정 || 폴더기본설정.기본요약표시설정
  };
};

/**
 * 기존 폴더를 새 설정 스키마로 마이그레이션하는 함수
 */
export const 폴더설정마이그레이션하기 = (기존설정: any): 폴더설정타입 => {
  return {
    시간표시여부: 기존설정.시간표시여부 ?? true,
    입력방식: 기존설정.입력방식 || '단순채팅',
    카테고리목록: 기존설정.카테고리목록,
    캐릭터목록: 기존설정.캐릭터목록,
    하위입력활성화: 기존설정.하위입력활성화 ?? false,
    동적카테고리사용: 기존설정.동적카테고리사용,
    카테고리조합설정: 기존설정.카테고리조합설정,
    카테고리자동선택설정: 기존설정.카테고리자동선택설정,
    
    // 🔥 새로 추가된 설정들
    기본채팅표시설정: 기존설정.기본채팅표시설정 || 기본채팅표시설정,
    기본요약표시설정: 기존설정.기본요약표시설정 || 기본요약표시설정
  };
};