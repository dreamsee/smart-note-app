// ν†µν•© λ·° μ±„ν… ν‘μ‹ μ ν‹Έλ¦¬ν‹°
import { μ±„ν…λ©”μ‹μ§€νƒ€μ…, λ…ΈνΈνƒ€μ…, ν΄λ”μ„¤μ •νƒ€μ… } from '../νƒ€μ…';

// π”¥ μ±„ν… λ©”μ‹μ§€ ν‘μ‹ λ΅μ§
export class μ±„ν…ν‘μ‹μ ν‹Έλ¦¬ν‹° {
  
  /**
   * λ…ΈνΈμ μ±„ν… λ©”μ‹μ§€λ¥Ό μ„¤μ •μ— λ”°λΌ ν•„ν„°λ§ν•μ—¬ λ°ν™
   */
  static ν‘μ‹ν• λ©”μ‹μ§€λ©λ΅κ°€μ Έμ¤κΈ°(
    λ…ΈνΈ: λ…ΈνΈνƒ€μ…, 
    ν΄λ”μ„¤μ •: ν΄λ”μ„¤μ •νƒ€μ…
  ): {
    ν‘μ‹λ©”μ‹μ§€λ©λ΅: μ±„ν…λ©”μ‹μ§€νƒ€μ…[];
    μ¨κ²¨μ§„λ©”μ‹μ§€κ°μ: number;
    μ „μ²΄λ©”μ‹μ§€κ°μ: number;
  } {
    const μ „μ²΄λ©”μ‹μ§€λ©λ΅ = λ…ΈνΈ.μ±„ν…λ©”μ‹μ§€λ©λ΅;
    
    // λ…ΈνΈλ³„ μ„¤μ •μ΄ μμΌλ©΄ μ‚¬μ©, μ—†μΌλ©΄ ν΄λ” κΈ°λ³Έ μ„¤μ • μ‚¬μ©
    const μ±„ν…μ„¤μ • = λ…ΈνΈ.λ…ΈνΈμ„¤μ •?.μ±„ν…ν‘μ‹μ„¤μ • || {
      μµλ€ν‘μ‹κ°μ: ν΄λ”μ„¤μ •.κΈ°λ³Έμ±„ν…ν‘μ‹μ„¤μ •.μµλ€ν‘μ‹κ°μ,
      ν‘μ‹μμ„: ν΄λ”μ„¤μ •.κΈ°λ³Έμ±„ν…ν‘μ‹μ„¤μ •.ν‘μ‹μμ„,
      μ¤ν¬λ΅¤ν‘μ‹μ—¬λ¶€: ν΄λ”μ„¤μ •.κΈ°λ³Έμ±„ν…ν‘μ‹μ„¤μ •.μ¤ν¬λ΅¤ν‘μ‹μ—¬λ¶€
    };
    
    // λ¨λ“  λ©”μ‹μ§€ (ν•μ„ λ©”μ‹μ§€ ν¬ν•¨) ν‰νƒ„ν™”
    const ν‰νƒ„ν™”λλ©”μ‹μ§€λ©λ΅ = this.λ©”μ‹μ§€λ©λ΅ν‰νƒ„ν™”ν•κΈ°(μ „μ²΄λ©”μ‹μ§€λ©λ΅);
    
    // μ •λ ¬
    const μ •λ ¬λλ©”μ‹μ§€λ©λ΅ = this.λ©”μ‹μ§€λ©λ΅μ •λ ¬ν•κΈ°(ν‰νƒ„ν™”λλ©”μ‹μ§€λ©λ΅, μ±„ν…μ„¤μ •.ν‘μ‹μμ„);
    
    // ν‘μ‹ν•  λ©”μ‹μ§€ κ°μ μ ν•
    const ν‘μ‹λ©”μ‹μ§€λ©λ΅ = μ •λ ¬λλ©”μ‹μ§€λ©λ΅.slice(0, μ±„ν…μ„¤μ •.μµλ€ν‘μ‹κ°μ);
    const μ¨κ²¨μ§„λ©”μ‹μ§€κ°μ = Math.max(0, μ •λ ¬λλ©”μ‹μ§€λ©λ΅.length - μ±„ν…μ„¤μ •.μµλ€ν‘μ‹κ°μ);
    
    return {
      ν‘μ‹λ©”μ‹μ§€λ©λ΅,
      μ¨κ²¨μ§„λ©”μ‹μ§€κ°μ,
      μ „μ²΄λ©”μ‹μ§€κ°μ: μ •λ ¬λλ©”μ‹μ§€λ©λ΅.length
    };
  }
  
  /**
   * λ¨λ“  λ©”μ‹μ§€ (ν•μ„ λ©”μ‹μ§€ ν¬ν•¨)λ¥Ό ν‰νƒ„ν™”
   */
  private static λ©”μ‹μ§€λ©λ΅ν‰νƒ„ν™”ν•κΈ°(λ©”μ‹μ§€λ©λ΅: μ±„ν…λ©”μ‹μ§€νƒ€μ…[]): μ±„ν…λ©”μ‹μ§€νƒ€μ…[] {
    const κ²°κ³Ό: μ±„ν…λ©”μ‹μ§€νƒ€μ…[] = [];
    
    for (const λ©”μ‹μ§€ of λ©”μ‹μ§€λ©λ΅) {
      κ²°κ³Ό.push(λ©”μ‹μ§€);
      
      // ν•μ„ λ©”μ‹μ§€κ°€ μμΌλ©΄ μ¬κ·€μ μΌλ΅ μ¶”κ°€
      if (λ©”μ‹μ§€.ν•μ„λ©”μ‹μ§€λ©λ΅ && λ©”μ‹μ§€.ν•μ„λ©”μ‹μ§€λ©λ΅.length > 0) {
        κ²°κ³Ό.push(...this.λ©”μ‹μ§€λ©λ΅ν‰νƒ„ν™”ν•κΈ°(λ©”μ‹μ§€.ν•μ„λ©”μ‹μ§€λ©λ΅));
      }
    }
    
    return κ²°κ³Ό;
  }
  
  /**
   * λ©”μ‹μ§€ λ©λ΅μ„ μ„¤μ •μ— λ”°λΌ μ •λ ¬
   */
  private static λ©”μ‹μ§€λ©λ΅μ •λ ¬ν•κΈ°(
    λ©”μ‹μ§€λ©λ΅: μ±„ν…λ©”μ‹μ§€νƒ€μ…[], 
    μ •λ ¬μμ„: 'μµμ‹ μ' | 'μ‹κ°„μ'
  ): μ±„ν…λ©”μ‹μ§€νƒ€μ…[] {
    const λ³µμ‚¬λλ©λ΅ = [...λ©”μ‹μ§€λ©λ΅];
    
    if (μ •λ ¬μμ„ === 'μµμ‹ μ') {
      // μµμ‹ μ: μµκ·Ό λ©”μ‹μ§€λ¶€ν„°
      return λ³µμ‚¬λλ©λ΅.sort((a, b) => b.νƒ€μ„μ¤νƒ¬ν”„.getTime() - a.νƒ€μ„μ¤νƒ¬ν”„.getTime());
    } else {
      // μ‹κ°„μ: μ¤λλ λ©”μ‹μ§€λ¶€ν„°
      return λ³µμ‚¬λλ©λ΅.sort((a, b) => a.νƒ€μ„μ¤νƒ¬ν”„.getTime() - b.νƒ€μ„μ¤νƒ¬ν”„.getTime());
    }
  }
  
  /**
   * μ¨κ²¨μ§„ λ©”μ‹μ§€ ν‘μ‹μ© μ”μ•½ ν…μ¤νΈ μƒμ„±
   */
  static μ¨κ²¨μ§„λ©”μ‹μ§€μ”μ•½μƒμ„±ν•κΈ°(μ¨κ²¨μ§„κ°μ: number): string {
    if (μ¨κ²¨μ§„κ°μ === 0) return '';
    return `β‹― ${μ¨κ²¨μ§„κ°μ}κ°μ μ¶”κ°€ λ©”μ‹μ§€κ°€ μμµλ‹λ‹¤`;
  }
}

// π”¥ μ”μ•½ ν‘μ‹ λ΅μ§
export class μ”μ•½ν‘μ‹μ ν‹Έλ¦¬ν‹° {
  
  /**
   * λ…ΈνΈμ μ”μ•½ ν‘μ‹ μ„¤μ • κ°€μ Έμ¤κΈ°
   */
  static μ”μ•½ν‘μ‹μ„¤μ •κ°€μ Έμ¤κΈ°(λ…ΈνΈ: λ…ΈνΈνƒ€μ…, ν΄λ”μ„¤μ •: ν΄λ”μ„¤μ •νƒ€μ…) {
    return λ…ΈνΈ.λ…ΈνΈμ„¤μ •?.μ”μ•½ν‘μ‹μ„¤μ • || {
      κΈ°λ³Έμƒνƒ: ν΄λ”μ„¤μ •.κΈ°λ³Έμ”μ•½ν‘μ‹μ„¤μ •.κΈ°λ³Έμƒνƒ,
      μ ‘νμ‹μ„μΉ: ν΄λ”μ„¤μ •.κΈ°λ³Έμ”μ•½ν‘μ‹μ„¤μ •.μ ‘νμ‹μ„μΉ,
      μλ™μ”μ•½μƒμ„±: ν΄λ”μ„¤μ •.κΈ°λ³Έμ”μ•½ν‘μ‹μ„¤μ •.μλ™μ”μ•½μƒμ„±
    };
  }
  
  /**
   * μ”μ•½μ΄ λΉ„μ–΄μλ”μ§€ ν™•μΈ
   */
  static μ”μ•½μ΄λΉ„μ–΄μλ”μ§€ν™•μΈ(λ…ΈνΈ: λ…ΈνΈνƒ€μ…): boolean {
    return !λ…ΈνΈ.μ”μ•½ || λ…ΈνΈ.μ”μ•½.trim().length === 0;
  }
  
  /**
   * μλ™ μ”μ•½ μƒμ„± (ν–¥ν›„ ν™•μ¥μ© - ν„μ¬λ” κΈ°λ³Έ κµ¬ν„)
   */
  static μλ™μ”μ•½μƒμ„±ν•κΈ°(λ…ΈνΈ: λ…ΈνΈνƒ€μ…): string {
    const λ©”μ‹μ§€μ = λ…ΈνΈ.μ±„ν…λ©”μ‹μ§€λ©λ΅.length;
    const μµκ·Όλ©”μ‹μ§€ = λ…ΈνΈ.μ±„ν…λ©”μ‹μ§€λ©λ΅[λ…ΈνΈ.μ±„ν…λ©”μ‹μ§€λ©λ΅.length - 1];
    
    if (λ©”μ‹μ§€μ === 0) return 'λ‚΄μ©μ΄ μ—†μµλ‹λ‹¤.';
    if (λ©”μ‹μ§€μ === 1) return `"${μµκ·Όλ©”μ‹μ§€.ν…μ¤νΈ.slice(0, 50)}${μµκ·Όλ©”μ‹μ§€.ν…μ¤νΈ.length > 50 ? '...' : ''}"`;
    
    return `${λ©”μ‹μ§€μ}κ°μ λ©”μ‹μ§€κ°€ μμµλ‹λ‹¤. μµκ·Ό: "${μµκ·Όλ©”μ‹μ§€.ν…μ¤νΈ.slice(0, 30)}${μµκ·Όλ©”μ‹μ§€.ν…μ¤νΈ.length > 30 ? '...' : ''}"`;
  }
}

// π”¥ κΈ°λ³Έ μ„¤μ •κ°’ μƒμ
export const κΈ°λ³Έμ±„ν…ν‘μ‹μ„¤μ • = {
  μµλ€ν‘μ‹κ°μ: 7,
  ν‘μ‹μμ„: 'μµμ‹ μ' as const,
  μ¤ν¬λ΅¤ν‘μ‹μ—¬λ¶€: true
};

export const κΈ°λ³Έμ”μ•½ν‘μ‹μ„¤μ • = {
  κΈ°λ³Έμƒνƒ: 'μ ‘ν' as const,
  μ ‘νμ‹μ„μΉ: 'ν•λ‹¨' as const,
  μλ™μ”μ•½μƒμ„±: false
};