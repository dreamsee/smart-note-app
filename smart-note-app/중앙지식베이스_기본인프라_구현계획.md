# 중앙 지식 베이스 기본 인프라 구현 계획

## 📋 프로젝트 개요

### 목표
7차원 스마트 노트 시스템의 핵심 인프라로서, 모든 에이전트의 학습 결과와 경험을 중앙 집중식으로 관리하는 지식 베이스 구축

### 범위
- 기본 지식 구조 설계 및 구현
- 감정 분석 엔진과의 통합
- UI/UX 디자인 경험 데이터 저장
- 기초적인 지식 검색 및 추천 시스템

### 기간
4주 (2025년 2월 1일 ~ 2025년 2월 28일)

## 🎯 핵심 통합 목표

### 1. 7차원 노트 시스템과의 통합
```typescript
// 7차원 데이터와 지식 베이스 연결
interface 차원별지식매핑 {
  시간차원: ChronologicalKnowledge;      // 1차원
  공간차원: SpatialKnowledge;           // 2차원  
  카테고리차원: CategoricalKnowledge;    // 3차원
  관계차원: RelationalKnowledge;        // 4차원
  우선순위차원: PriorityKnowledge;      // 5차원
  감정차원: EmotionalKnowledge;         // 6차원
  맥락차원: ContextualKnowledge;        // 7차원
}
```

### 2. 에이전트 시스템과의 통합
- 감정 분석 엔진의 학습 결과 저장
- UI/UX 디자인 경험 데이터 축적
- 문고리 철학 기반 타이밍 패턴 학습

## 🏗️ 인프라 아키텍처

### 1. 데이터베이스 스키마 설계
```sql
-- 중앙 지식 베이스 핵심 테이블
CREATE TABLE IF NOT EXISTS 지식항목 (
    지식ID UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    생성일시 TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    마지막업데이트 TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    생성에이전트 TEXT NOT NULL,
    신뢰도점수 DECIMAL(3,2) CHECK (신뢰도점수 >= 0 AND 신뢰도점수 <= 1),
    
    -- 지식 분류
    카테고리 TEXT CHECK (카테고리 IN ('패턴', '경험', '규칙', '메타')),
    하위카테고리 TEXT,
    제목 TEXT NOT NULL,
    설명 TEXT,
    
    -- 지식 내용 (JSONB for flexibility)
    지식내용 JSONB NOT NULL,
    적용조건 JSONB,
    검증정보 JSONB,
    
    -- 관계성
    관련지식 TEXT[], -- 다른 지식 ID들의 배열
    
    -- 메타데이터
    메타데이터 JSONB
);

-- 인덱스 생성
CREATE INDEX idx_지식항목_카테고리 ON 지식항목(카테고리);
CREATE INDEX idx_지식항목_생성에이전트 ON 지식항목(생성에이전트);
CREATE INDEX idx_지식항목_신뢰도 ON 지식항목(신뢰도점수);
CREATE INDEX idx_지식항목_내용 ON 지식항목 USING GIN (지식내용);
CREATE INDEX idx_지식항목_조건 ON 지식항목 USING GIN (적용조건);

-- 지식 접근 로그 테이블
CREATE TABLE IF NOT EXISTS 지식접근로그 (
    로그ID UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    지식ID UUID REFERENCES 지식항목(지식ID),
    접근에이전트 TEXT NOT NULL,
    접근시간 TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    접근유형 TEXT CHECK (접근유형 IN ('조회', '생성', '수정', '검증')),
    성과지표 JSONB
);

-- 지식 관계 테이블
CREATE TABLE IF NOT EXISTS 지식관계 (
    관계ID UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    출발지식ID UUID REFERENCES 지식항목(지식ID),
    도착지식ID UUID REFERENCES 지식항목(지식ID),
    관계유형 TEXT CHECK (관계유형 IN ('전제조건', '파생', '대안', '보완')),
    관계강도 DECIMAL(3,2),
    생성일시 TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);
```

### 2. 핵심 서비스 계층 설계
```typescript
// src/서비스/중앙지식베이스서비스.ts
export class 중앙지식베이스서비스 {
  constructor(private supabase: SupabaseClient) {}
  
  /**
   * 지식 항목 생성
   */
  async 지식생성하기(
    지식데이터: 지식생성요청,
    생성에이전트: string
  ): Promise<지식항목> {
    // 1. 중복성 검사
    const 중복검사 = await this.중복성검사하기(지식데이터);
    if (중복검사.중복발견) {
      return await this.기존지식개선하기(중복검사.기존지식ID, 지식데이터);
    }
    
    // 2. 지식 생성
    const { data, error } = await this.supabase
      .from('지식항목')
      .insert({
        생성에이전트,
        카테고리: 지식데이터.카테고리,
        하위카테고리: 지식데이터.하위카테고리,
        제목: 지식데이터.제목,
        설명: 지식데이터.설명,
        지식내용: 지식데이터.내용,
        적용조건: 지식데이터.적용조건,
        신뢰도점수: 지식데이터.초기신뢰도 || 0.5
      })
      .select()
      .single();
    
    if (error) throw error;
    
    // 3. 관련 지식 연결
    if (지식데이터.관련지식) {
      await this.관련지식연결하기(data.지식ID, 지식데이터.관련지식);
    }
    
    return data;
  }
  
  /**
   * 컨텍스트 기반 지식 검색
   */
  async 컨텍스트기반검색하기(
    검색컨텍스트: 검색컨텍스트,
    요청에이전트: string,
    옵션?: 검색옵션
  ): Promise<지식항목[]> {
    let query = this.supabase
      .from('지식항목')
      .select('*');
    
    // 카테고리 필터
    if (검색컨텍스트.카테고리) {
      query = query.eq('카테고리', 검색컨텍스트.카테고리);
    }
    
    // 신뢰도 필터
    if (옵션?.최소신뢰도) {
      query = query.gte('신뢰도점수', 옵션.최소신뢰도);
    }
    
    // JSONB 조건 검색
    if (검색컨텍스트.적용조건) {
      query = query.contains('적용조건', 검색컨텍스트.적용조건);
    }
    
    const { data, error } = await query
      .order('신뢰도점수', { ascending: false })
      .limit(옵션?.결과수 || 10);
    
    if (error) throw error;
    
    // 접근 로그 기록
    await this.접근로그기록하기(data.map(d => d.지식ID), 요청에이전트, '조회');
    
    return data;
  }
  
  /**
   * 지식 신뢰도 업데이트
   */
  async 신뢰도업데이트하기(
    지식ID: string,
    성과데이터: 성과데이터
  ): Promise<void> {
    // 기존 검증 정보 조회
    const { data: 기존지식 } = await this.supabase
      .from('지식항목')
      .select('검증정보, 신뢰도점수')
      .eq('지식ID', 지식ID)
      .single();
    
    // 새로운 신뢰도 계산
    const 새신뢰도 = this.신뢰도계산하기(
      기존지식.검증정보,
      성과데이터
    );
    
    // 업데이트
    await this.supabase
      .from('지식항목')
      .update({
        신뢰도점수: 새신뢰도,
        검증정보: {
          ...기존지식.검증정보,
          적용횟수: (기존지식.검증정보?.적용횟수 || 0) + 1,
          마지막검증일: new Date()
        }
      })
      .eq('지식ID', 지식ID);
  }
  
  /**
   * 중복성 검사
   */
  private async 중복성검사하기(
    지식데이터: 지식생성요청
  ): Promise<중복검사결과> {
    // 제목과 카테고리로 기본 검색
    const { data } = await this.supabase
      .from('지식항목')
      .select('지식ID, 제목, 지식내용')
      .eq('카테고리', 지식데이터.카테고리)
      .ilike('제목', `%${지식데이터.제목}%`);
    
    if (!data || data.length === 0) {
      return { 중복발견: false };
    }
    
    // 내용 유사도 검사
    for (const 기존지식 of data) {
      const 유사도 = this.내용유사도계산하기(
        지식데이터.내용,
        기존지식.지식내용
      );
      
      if (유사도 > 0.8) {
        return {
          중복발견: true,
          기존지식ID: 기존지식.지식ID,
          유사도
        };
      }
    }
    
    return { 중복발견: false };
  }
}
```

### 3. 감정 분석 엔진 통합
```typescript
// src/서비스/감정지식통합서비스.ts
export class 감정지식통합서비스 {
  constructor(
    private 지식베이스: 중앙지식베이스서비스,
    private 감정분석기: 감정분석기
  ) {}
  
  /**
   * 감정 분석 결과를 지식으로 저장
   */
  async 감정패턴학습하기(
    메시지: 채팅메시지타입,
    분석결과: 감정분석결과,
    사용자반응?: 사용자반응
  ): Promise<void> {
    const 감정지식 = {
      카테고리: '패턴' as const,
      하위카테고리: '감정패턴',
      제목: `${분석결과.주감정} 감정 패턴 - ${분석결과.텍스트톤}`,
      설명: '감정 분석 패턴 학습 결과',
      내용: {
        감정분석결과: 분석결과,
        원본텍스트특징: this.텍스트특징추출하기(메시지.텍스트),
        사용자반응: 사용자반응,
        문고리준비도: this.문고리준비도계산하기(분석결과)
      },
      적용조건: {
        감정유형: 분석결과.주감정,
        텍스트톤: 분석결과.텍스트톤,
        감정강도범위: [분석결과.감정강도 - 1, 분석결과.감정강도 + 1]
      },
      초기신뢰도: 분석결과.신뢰도
    };
    
    await this.지식베이스.지식생성하기(감정지식, '감정분석엔진');
  }
  
  /**
   * 감정 개입 성공 사례 학습
   */
  async 감정개입결과학습하기(
    개입데이터: 감정개입데이터,
    결과: 개입결과
  ): Promise<void> {
    const 개입지식 = {
      카테고리: '경험' as const,
      하위카테고리: '감정개입경험',
      제목: `${개입데이터.개입유형} - ${결과.효과성}`,
      설명: '감정 개입 경험 데이터',
      내용: {
        개입상황: 개입데이터,
        개입결과: 결과,
        문고리위치: 개입데이터.문고리상태,
        효과측정: 결과.사용자만족도
      },
      적용조건: {
        감정상태: 개입데이터.감정상태,
        문고리준비도: 개입데이터.문고리상태.준비도,
        개입유형: 개입데이터.개입유형
      },
      초기신뢰도: 결과.효과성 > 0.7 ? 0.8 : 0.5
    };
    
    await this.지식베이스.지식생성하기(개입지식, '감정개입시스템');
  }
}
```

### 4. UI/UX 디자인 경험 통합
```typescript
// src/서비스/디자인지식통합서비스.ts
export class 디자인지식통합서비스 {
  constructor(
    private 지식베이스: 중앙지식베이스서비스
  ) {}
  
  /**
   * 디자인 경험을 지식으로 변환
   */
  async 디자인경험저장하기(
    경험데이터: 디자인경험데이터
  ): Promise<void> {
    const 디자인지식 = {
      카테고리: '경험' as const,
      하위카테고리: '디자인경험',
      제목: `${경험데이터.컴포넌트유형} - ${경험데이터.디자인결정.의도}`,
      설명: 경험데이터.결과분석.교훈,
      내용: {
        프로젝트컨텍스트: 경험데이터.프로젝트컨텍스트,
        디자인결정: 경험데이터.디자인결정,
        사용자피드백: 경험데이터.사용자피드백,
        결과분석: 경험데이터.결과분석
      },
      적용조건: {
        컴포넌트유형: 경험데이터.컴포넌트유형,
        기술스택: 경험데이터.프로젝트컨텍스트.기술스택,
        디자인철학: 경험데이터.프로젝트컨텍스트.철학
      },
      초기신뢰도: this.피드백기반신뢰도계산하기(경험데이터.사용자피드백)
    };
    
    await this.지식베이스.지식생성하기(디자인지식, 'UI_UX디자인학습에이전트');
  }
  
  /**
   * 디자인 패턴 검색
   */
  async 유사디자인패턴검색하기(
    디자인문제: 디자인문제
  ): Promise<디자인해결책[]> {
    const 검색조건 = {
      카테고리: '경험',
      하위카테고리: '디자인경험',
      적용조건: {
        컴포넌트유형: 디자인문제.컴포넌트유형,
        기술스택: 디자인문제.기술제약
      }
    };
    
    const 관련지식들 = await this.지식베이스.컨텍스트기반검색하기(
      검색조건,
      'UI_UX디자인학습에이전트',
      { 최소신뢰도: 0.6 }
    );
    
    return 관련지식들.map(지식 => this.지식을해결책으로변환하기(지식));
  }
}
```

## 🔧 주차별 구현 계획

### 1주차: 데이터베이스 인프라 구축
**목표**: 핵심 데이터베이스 스키마 구현 및 기본 서비스 구축

#### 작업 항목
1. **Supabase 테이블 생성**
   ```bash
   # migration-knowledge-base.sql 실행
   supabase migration new knowledge-base
   ```

2. **기본 서비스 클래스 구현**
   - 중앙지식베이스서비스.ts
   - 타입 정의 (지식항목타입.ts)
   - 기본 CRUD 작업

3. **테스트 환경 구축**
   ```typescript
   // src/테스트/지식베이스테스트.ts
   describe('중앙 지식 베이스', () => {
     it('지식 생성 및 조회', async () => {
       // 지식 생성 테스트
       // 중복성 검사 테스트
       // 컨텍스트 검색 테스트
     });
   });
   ```

#### 산출물
- [ ] 데이터베이스 마이그레이션 스크립트
- [ ] 중앙지식베이스서비스.ts 구현
- [ ] 기본 테스트 케이스

### 2주차: 감정 분석 엔진 통합
**목표**: 감정 지식 저장 및 활용 시스템 구현

#### 작업 항목
1. **감정 지식 통합 서비스**
   - 감정 패턴 학습 로직
   - 문고리 타이밍 지식 저장
   - 개입 결과 피드백 학습

2. **실시간 감정 지식 활용**
   ```typescript
   // src/훅/use감정지식.ts
   export const use감정지식 = (현재감정상태: 감정상태) => {
     const [관련지식, set관련지식] = useState<지식항목[]>([]);
     
     useEffect(() => {
       // 실시간 관련 지식 검색
     }, [현재감정상태]);
     
     return { 관련지식, 추천개입방식 };
   };
   ```

3. **감정 분석 UI 통합**
   - 지식 기반 감정 분석 표시
   - 추천 개입 방식 UI

#### 산출물
- [ ] 감정지식통합서비스.ts 구현
- [ ] 감정 지식 활용 훅
- [ ] UI 컴포넌트 통합

### 3주차: UI/UX 디자인 경험 통합
**목표**: 디자인 지식 저장 및 추천 시스템 구현

#### 작업 항목
1. **디자인 경험 수집 시스템**
   - 디자인 결정 자동 기록
   - 사용자 피드백 수집
   - 성공/실패 패턴 분석

2. **디자인 지식 추천 엔진**
   ```typescript
   // src/서비스/디자인추천서비스.ts
   export class 디자인추천서비스 {
     async 디자인제안생성하기(
       디자인문제: 디자인문제
     ): Promise<디자인제안[]> {
       // 유사 경험 검색
       // 성공 패턴 적용
       // 맞춤형 제안 생성
     }
   }
   ```

3. **디자인 가이드 UI**
   - 실시간 디자인 제안
   - 과거 경험 참조
   - A/B 테스트 결과 표시

#### 산출물
- [ ] 디자인지식통합서비스.ts 구현
- [ ] 디자인추천서비스.ts 구현
- [ ] 디자인 가이드 UI 컴포넌트

### 4주차: 통합 및 최적화
**목표**: 전체 시스템 통합 및 성능 최적화

#### 작업 항목
1. **지식 동기화 시스템**
   - 실시간 지식 전파
   - 캐싱 시스템 구현
   - 배치 동기화 프로세스

2. **성능 최적화**
   ```typescript
   // src/서비스/지식캐시서비스.ts
   export class 지식캐시서비스 {
     private 캐시 = new Map<string, CacheEntry>();
     
     async 캐시된지식조회(키: string): Promise<지식항목 | null> {
       // LRU 캐시 구현
       // 자동 갱신 로직
     }
   }
   ```

3. **통합 대시보드**
   - 지식 베이스 통계
   - 에이전트별 기여도
   - 지식 활용 현황

#### 산출물
- [ ] 지식 동기화 시스템
- [ ] 캐싱 및 최적화
- [ ] 통합 대시보드

## 📊 성공 지표

### 기술적 지표
- **지식 생성 속도**: < 100ms
- **검색 응답 시간**: < 200ms
- **중복 감지 정확도**: > 90%
- **캐시 적중률**: > 80%

### 비즈니스 지표
- **지식 재사용률**: > 60%
- **에이전트 간 지식 공유**: > 100건/일
- **신뢰도 향상**: 평균 0.5 → 0.8

## 🚀 향후 발전 방향

### Phase 2 (3개월)
- 지능형 지식 추천
- 자동 지식 품질 관리
- 예측적 지식 생성

### Phase 3 (6개월)
- 크로스 도메인 지식 융합
- 창의적 지식 조합
- 외부 지식 소스 통합

### Phase 4 (1년)
- 자율 진화하는 지식 베이스
- 인간-AI 협력 지식 생태계
- 오픈 지식 플랫폼

## 🎯 즉시 실행 항목

### 이번 주 목표
1. **데이터베이스 스키마 설계 완료**
2. **기본 서비스 인터페이스 정의**
3. **감정 분석 엔진과의 통합 포인트 식별**

### 첫 번째 마일스톤
- 지식 생성 및 조회 기능 구현
- 감정 패턴 첫 번째 학습 완료
- 디자인 경험 첫 번째 저장 완료

---

**작성일**: 2025-01-31
**작성자**: 스마트 노트 개발팀
**다음 검토**: 2025-02-07 (1주차 완료 후)