# 7차원 노트 시스템 Phase 1 설계 문서

## 📋 프로젝트 개요

**목표**: 기존 2D 노트 시스템을 7차원으로 확장하여 정보의 다층적 구조화 실현

**현재 상태**: 1-4차원 부분 구현됨, 5-7차원 신규 구현 필요

## 🎯 7차원 구조 정의

### 기존 구현된 차원 (1-4차원)
1. **1차원: 시간** ✅
   - 현재 구현: 생성시간, 수정시간, 메시지 타임스탬프
   - 데이터: `생성시간: Date`, `수정시간: Date`

2. **2차원: 공간** ✅  
   - 현재 구현: 폴더/노트 계층 구조
   - 데이터: `폴더아이디: string`, `노트아이디: string`

3. **3차원: 카테고리** ✅
   - 현재 구현: 태그 시스템, 카테고리형 입력
   - 데이터: `태그목록: string[]`, `카테고리목록`

4. **4차원: 관계** 🔶 부분 구현
   - 현재 구현: 하위메시지 (부모-자식 관계)
   - 데이터: `부모메시지아이디?: string`
   - **확장 필요**: 노트 간 관계, 참조 관계

### 신규 구현 필요 차원 (5-7차원)

5. **5차원: 중요도/우선순위** 🆕
   - 목적: 정보의 중요도와 처리 우선순위 관리
   - 구현 대상: 긴급도, 중요도, 우선순위 레벨
   
6. **6차원: 감정/톤** 🆕
   - 목적: 감정 상태, 텍스트 톤, 기분 추적
   - 구현 대상: 감정 상태, 톤 분류, 기분 지수

7. **7차원: 맥락/상황** 🆕
   - 목적: 작성 상황, 환경, 배경 정보 관리
   - 구현 대상: 위치, 상황, 환경, 목적

## 📊 Phase 1: 데이터 모델 설계

### 새로운 타입 정의

#### 5차원: 우선순위 타입
```typescript
// 우선순위 레벨 (1-5단계)
export type 우선순위레벨타입 = 1 | 2 | 3 | 4 | 5;

// 긴급도 분류
export type 긴급도타입 = '즉시' | '당일' | '이번주' | '이번달' | '언젠가';

// 중요도 매트릭스 (아이젠하워 매트릭스)
export type 중요도타입 = {
  긴급하고중요함: boolean;    // 1사분면: 즉시 처리
  중요하지만긴급하지않음: boolean; // 2사분면: 계획하여 처리  
  긴급하지만중요하지않음: boolean; // 3사분면: 위임하거나 빠르게 처리
  긴급하지도중요하지도않음: boolean; // 4사분면: 제거 고려
};

// 5차원 통합 타입
export interface 우선순위차원타입 {
  우선순위레벨: 우선순위레벨타입;
  긴급도: 긴급도타입;
  중요도매트릭스: 중요도타입;
  마감일?: Date;
  예상소요시간?: number; // 분 단위
}
```

#### 6차원: 감정/톤 타입
```typescript
// 기본 감정 분류 (6가지 기본 감정)
export type 기본감정타입 = '기쁨' | '슬픔' | '분노' | '두려움' | '놀람' | '혐오';

// 감정 강도 (1-10점)
export type 감정강도타입 = 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10;

// 텍스트 톤 분류
export type 텍스트톤타입 = 
  | '공식적' | '비공식적' | '친근한' | '차가운' 
  | '긍정적' | '부정적' | '중립적' | '유머러스'
  | '진지한' | '캐주얼한' | '비판적' | '칭찬하는';

// 기분 상태 (복합 감정)
export interface 기분상태타입 {
  주감정: 기본감정타입;
  부감정?: 기본감정타입[];
  전체강도: 감정강도타입;
  에너지레벨: 1 | 2 | 3 | 4 | 5; // 매우낮음~매우높음
}

// 6차원 통합 타입
export interface 감정차원타입 {
  기분상태: 기분상태타입;
  텍스트톤: 텍스트톤타입;
  감정노트?: string; // 감정에 대한 메모
  감정변화추적?: {
    이전상태?: 기분상태타입;
    변화시점: Date;
    변화원인?: string;
  };
}
```

#### 7차원: 맥락/상황 타입
```typescript
// 위치 정보
export interface 위치정보타입 {
  장소명?: string;
  좌표?: {
    위도: number;
    경도: number;
  };
  장소유형?: '집' | '사무실' | '카페' | '학교' | '야외' | '이동중' | '기타';
}

// 상황 분류
export type 상황유형타입 = 
  | '업무' | '학습' | '개인' | '가족' | '친구' | '취미'
  | '회의' | '브레인스토밍' | '검토' | '계획' | '실행' | '회고';

// 환경 정보
export interface 환경정보타입 {
  디바이스?: 'PC' | '모바일' | '태블릿';
  네트워크상태?: '온라인' | '오프라인' | '불안정';
  주변소음레벨?: 1 | 2 | 3 | 4 | 5; // 매우조용~매우시끄러움
  집중도?: 1 | 2 | 3 | 4 | 5; // 매우산만~매우집중
}

// 목적/의도
export type 작성목적타입 = 
  | '기록' | '정리' | '계획' | '아이디어' | '문제해결'
  | '학습' | '공유' | '보고' | '검토' | '임시메모';

// 7차원 통합 타입
export interface 맥락차원타입 {
  위치정보?: 위치정보타입;
  상황유형: 상황유형타입;
  환경정보: 환경정보타입;
  작성목적: 작성목적타입;
  참여자?: string[]; // 함께한 사람들
  관련프로젝트?: string; // 연관 프로젝트명
  컨텍스트노트?: string; // 상황에 대한 추가 설명
}
```

### 확장된 메시지 및 노트 타입

```typescript
// 기존 채팅메시지타입에 7차원 추가
export interface 확장된채팅메시지타입 extends 채팅메시지타입 {
  // 5차원: 우선순위
  우선순위차원?: 우선순위차원타입;
  
  // 6차원: 감정/톤
  감정차원?: 감정차원타입;
  
  // 7차원: 맥락/상황
  맥락차원?: 맥락차원타입;
  
  // 4차원 확장: 관계 (기존 부모메시지아이디 외 추가)
  관련메시지목록?: string[]; // 참조하는 다른 메시지들
  메시지유형?: '일반' | '질문' | '답변' | '아이디어' | '결론' | '액션아이템';
}

// 기존 노트타입에 7차원 추가
export interface 확장된노트타입 extends 노트타입 {
  // 5차원: 우선순위
  우선순위차원?: 우선순위차원타입;
  
  // 6차원: 감정/톤
  감정차원?: 감정차원타입;
  
  // 7차원: 맥락/상황
  맥락차원?: 맥락차원타입;
  
  // 4차원 확장: 관계
  관련노트목록?: string[]; // 연결된 다른 노트들
  노트유형?: '일반' | '회의록' | '아이디어' | '계획' | '학습' | '일기' | '프로젝트';
  참조출처?: string[]; // 외부 참조 링크나 문서
}
```

## 🗄️ 데이터베이스 스키마 확장

### 1. 기존 테이블 확장 (ALTER)

```sql
-- 채팅메시지 테이블 확장
ALTER TABLE 채팅메시지목록 
ADD COLUMN IF NOT EXISTS 우선순위차원 JSONB,
ADD COLUMN IF NOT EXISTS 감정차원 JSONB,
ADD COLUMN IF NOT EXISTS 맥락차원 JSONB,
ADD COLUMN IF NOT EXISTS 관련메시지목록 TEXT[],
ADD COLUMN IF NOT EXISTS 메시지유형 TEXT DEFAULT '일반';

-- 노트목록 테이블 확장  
ALTER TABLE 노트목록
ADD COLUMN IF NOT EXISTS 우선순위차원 JSONB,
ADD COLUMN IF NOT EXISTS 감정차원 JSONB,
ADD COLUMN IF NOT EXISTS 맥락차원 JSONB,
ADD COLUMN IF NOT EXISTS 관련노트목록 TEXT[],
ADD COLUMN IF NOT EXISTS 노트유형 TEXT DEFAULT '일반',
ADD COLUMN IF NOT EXISTS 참조출처 TEXT[];

-- 성능 최적화를 위한 인덱스 추가
CREATE INDEX IF NOT EXISTS idx_message_priority ON 채팅메시지목록 USING GIN (우선순위차원);
CREATE INDEX IF NOT EXISTS idx_message_emotion ON 채팅메시지목록 USING GIN (감정차원);
CREATE INDEX IF NOT EXISTS idx_message_context ON 채팅메시지목록 USING GIN (맥락차원);
CREATE INDEX IF NOT EXISTS idx_message_type ON 채팅메시지목록 (메시지유형);

CREATE INDEX IF NOT EXISTS idx_note_priority ON 노트목록 USING GIN (우선순위차원);
CREATE INDEX IF NOT EXISTS idx_note_emotion ON 노트목록 USING GIN (감정차원);
CREATE INDEX IF NOT EXISTS idx_note_context ON 노트목록 USING GIN (맥락차원);
CREATE INDEX IF NOT EXISTS idx_note_type ON 노트목록 (노트유형);
```

### 2. 7차원 분석을 위한 뷰 생성

```sql
-- 우선순위 분석 뷰
CREATE OR REPLACE VIEW 우선순위분석뷰 AS
SELECT 
  n.폴더아이디,
  n.아이디 as 노트아이디,
  n.제목,
  n.우선순위차원->>'우선순위레벨' as 우선순위레벨,
  n.우선순위차원->>'긴급도' as 긴급도,
  n.우선순위차원->>'마감일' as 마감일,
  n.생성시간,
  n.수정시간
FROM 노트목록 n 
WHERE n.우선순위차원 IS NOT NULL;

-- 감정 추이 분석 뷰
CREATE OR REPLACE VIEW 감정추이분석뷰 AS
SELECT 
  m.노트아이디,
  m.아이디 as 메시지아이디,
  m.감정차원->>'기분상태'->>'주감정' as 주감정,
  (m.감정차원->>'기분상태'->>'전체강도')::integer as 감정강도,
  m.감정차원->>'텍스트톤' as 텍스트톤,
  m.생성시간,
  m.텍스트
FROM 채팅메시지목록 m 
WHERE m.감정차원 IS NOT NULL
ORDER BY m.생성시간;

-- 맥락별 활동 분석 뷰
CREATE OR REPLACE VIEW 맥락별활동분석뷰 AS
SELECT 
  m.맥락차원->>'상황유형' as 상황유형,
  m.맥락차원->>'작성목적' as 작성목적,
  m.맥락차원->>'위치정보'->>'장소유형' as 장소유형,
  COUNT(*) as 메시지수,
  DATE(m.생성시간) as 날짜
FROM 채팅메시지목록 m 
WHERE m.맥락차원 IS NOT NULL
GROUP BY 상황유형, 작성목적, 장소유형, DATE(m.생성시간)
ORDER BY 날짜 DESC;
```

## 🔄 마이그레이션 전략

### 1. 점진적 마이그레이션
```typescript
// 기존 데이터 호환성 유지
export const 기존데이터호환성검사 = (메시지: 채팅메시지타입): 확장된채팅메시지타입 => {
  return {
    ...메시지,
    // 7차원 필드들은 optional이므로 기존 데이터 그대로 유지
    우선순위차원: undefined,
    감정차원: undefined,
    맥락차원: undefined,
    관련메시지목록: [],
    메시지유형: '일반'
  };
};

// 기본값 설정 함수
export const 기본7차원값생성 = (): {
  우선순위차원: 우선순위차원타입;
  감정차원: 감정차원타입;
  맥락차원: 맥락차원타입;
} => ({
  우선순위차원: {
    우선순위레벨: 3,
    긴급도: '언젠가',
    중요도매트릭스: {
      긴급하고중요함: false,
      중요하지만긴급하지않음: false,
      긴급하지만중요하지않음: false,
      긴급하지도중요하지도않음: true
    }
  },
  감정차원: {
    기분상태: {
      주감정: '기쁨',
      전체강도: 5,
      에너지레벨: 3
    },
    텍스트톤: '중립적'
  },
  맥락차원: {
    상황유형: '개인',
    환경정보: {
      집중도: 3
    },
    작성목적: '기록'
  }
});
```

### 2. 데이터 검증 및 정리
```typescript
// 7차원 데이터 유효성 검사
export const 차원데이터유효성검사 = {
  우선순위: (데이터: 우선순위차원타입): boolean => {
    return 데이터.우선순위레벨 >= 1 && 데이터.우선순위레벨 <= 5;
  },
  
  감정: (데이터: 감정차원타입): boolean => {
    const 유효한감정들: 기본감정타입[] = ['기쁨', '슬픔', '분노', '두려움', '놀람', '혐오'];
    return 유효한감정들.includes(데이터.기분상태.주감정);
  },
  
  맥락: (데이터: 맥락차원타입): boolean => {
    return 데이터.환경정보.집중도! >= 1 && 데이터.환경정보.집중도! <= 5;
  }
};
```

## 📈 성능 고려사항

### 1. JSONB 필드 최적화
- GIN 인덱스 활용으로 JSON 쿼리 성능 향상
- 자주 조회되는 필드는 별도 컬럼으로 추출 고려
- 복잡한 7차원 분석은 배치 처리로 별도 관리

### 2. 메모리 사용량 관리  
- 7차원 데이터는 optional로 설계하여 필요시에만 로드
- 무거운 분석 데이터는 별도 캐시 레이어 구성
- 프론트엔드에서는 필요한 차원만 선택적 로드

### 3. 실시간 동기화 최적화
- 7차원 데이터 변경 시에만 해당 차원 필드만 업데이트
- 대용량 JSON 데이터의 부분 업데이트 전략
- 클라이언트 사이드 캐싱으로 반복 조회 최소화

## 🎯 Phase 1 구현 순서

### 1주차: 타입 시스템 구축
- [ ] 5-7차원 타입 정의 완료
- [ ] 기존 타입과의 호환성 확보
- [ ] 타입 유틸리티 함수 구현

### 2주차: 데이터베이스 확장  
- [ ] SQL 마이그레이션 스크립트 작성
- [ ] 인덱스 및 뷰 생성
- [ ] 데이터 유효성 검사 구현

### 3주차: 서비스 레이어 구현
- [ ] 7차원 데이터 CRUD 서비스
- [ ] 기존 서비스와의 통합
- [ ] 성능 최적화 적용

## 📋 다음 단계 (Phase 2 준비)

Phase 1 완료 후 진행할 Phase 2 UI/UX 구현을 위한 준비:
- 7차원 입력 인터페이스 설계
- 다차원 데이터 시각화 방안 검토  
- 사용자 경험 개선을 위한 점진적 기능 도입 전략

---
**작성일**: 2025-01-29  
**예상 완료**: 2025-02-12 (2주 소요 예상)  
**다음 단계**: Phase 2 UI/UX 설계